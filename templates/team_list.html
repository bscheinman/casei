{% extends 'game_base.html' %}
{% load ncaa_tags %}

{% block title %}{{ game.name }} Team List{% endblock title %}

{% block game_scripts %}
    <script type='text/javascript' src='/static/sorttable.js/'></script>
    <script type='text/javascript'>
        function OnTradeResponse(data) {
            if (data.success)
                location.reload();
            else {
                var errorString = data.errors.join('\n');
                var field_errors = data.field_errors;
                for (var key in field_errors)
                    errorString += '\n' + field_errors[key];
                alert(errorString);
            }
        }

        function show_placer(team_name, side, price) {
            //$('#trade_title').html("<h4>Trade " + team_name + "</h4>");
            document.getElementById('team_id_field').value = team_name;
            var radioButtons = document.forms['tradeForm'].elements['side'];
            for (var i = 0 ; i < radioButtons.length ; ++i)
                radioButtons[i].checked = radioButtons[i].value == side;
            if (price != 0.0)
                document.getElementById('price_field').value = price;
            else
                document.getElementById('price_field').value = '';
            document.getElementById('quantity_field').value = '';
            $('#order_placer').modal();
        }

        $(document).ready(function() {
            var options = {
                dataType: 'json',
                success: OnTradeResponse
            };

            $('#tradeForm').ajaxForm(options);
        });
    </script>
{% endblock %}

{% block game_body %}
<div class='span7'>
    <table class='table table-bordered table-striped table-condensed sortable'>
        <thead><tr>
            <th>Team</th><th>Volume</th>
            {% if game.supports_stocks %}
                <th>Last</th><th class='sorttable_nosort' width='55'></th><th width='65'>Bid</th><th width='65'>Ask</th><th class='sorttable_nosort' width='55'></th>
            {% endif %}
        </tr></thead>
        {% for team, security in rows %}
            <tr>
                <td>{% team_link team.team.abbrev_name game %} </td>
                <td>{{ team.volume }}</td>
                {% if game.supports_stocks %}
                    <td>{{ security.get_last }}</td>
                    {% with bid=security.get_bid %}
                        <td><button class='btn btn-success' onclick='show_placer("{{team.team.abbrev_name}}", "buy", {{bid}})'>Buy</button></td><td>{{ bid }}</td>
                    {% endwith %}
                    {% with ask=security.get_ask %}
                        <td>{{ ask }}</td><td><button class='btn btn-danger' onclick='show_placer("{{team.team.abbrev_name}}", "sell", {{ask}})'>Sell</button></td>
                    {% endwith %}
                {% endif %}
            </tr>
        {% endfor %}
    </table>
</div>

<div id='order_placer' class='modal hide fade' style='width:250px;'>
    <div class='modal-header'>
        <div id='trade_title'></div>
        <a class='close' data-dismiss='modal'>x</a>
    </div>
    <div class='modal-body'>
        {% trade_form game %}
    </div>
</div>

{% endblock game_body %}
