{% extends 'game_base.html' %}
{% load ncaa_tags %}

{% block title %}{{ team.full_name }} Profile{% endblock title %}

{% block game_scripts %}
<script type='text/javascript'>
    function OnTradeResponse(responseText, statusText, xhr, $form) {
        alert(responseText);
    }

    $(document).ready(function() {
        var options = {
            dataType: 'json',
            success: OnTradeResponse
        };

        $('#tradeForm').ajaxForm(options);
    });
</script>
{% endblock game_scripts %}

{% block game_body %}
<h2>{{ team.full_name }} ({{ team.abbrev_name }})</h2>

{% if game %}
    {% if security %}
        <div id='market_data' class='span4 well'>
            Bid: {{ security.get_bid }}<br/>
            Ask: {{ security.get_ask }}<br/>
            Last: {{ security.get_last }}<br/>
        </div>
        <div id='bbo' class='span3 well'>
            <table class='table table-striped table-condensed table-bordered'>
                <tr><td>Bids</td><td>Asks</td></tr>
                    {% for bid, ask in security.get_bbo_table %}
                        <tr><td>{% if bid %}{{ bid.price }} ({{ bid.quantity_remaining }}) {% endif %}</td>
                        <td>{% if ask %}{{ ask.price }} ({{ ask.quantity_remaining }}) {% endif %}</td></tr>
                    {% endfor %}
            </table>
        </div>
    {% endif %}
<div id='order_placer' class='span4 well'>
    <form id='tradeForm' method='POST' action='/ncaa/game/{{game.id}}/team/{{team.id}}/place_order/'>
        {% csrf_token %}
        Shares <input type='text' name='quantity' size='5'><br/>
        Price <input type='text' name='price' size='6'><br/>
        <input type='radio' name='side' value='buy'>Buy <input type='radio' name='side' value='sell'>Sell<br/>
        <button type='submit' class='btn btn-success'>Submit Order</button>
    </form>
</div>
{% endif %}

<div id='score_counts' class='span5'>
<table class='table table-bordered table-striped table-condensed'>
{% if game %}
    <tr><td></td><td>Wins</td><td>Points</td></tr>
    {% for scoreType, count, row_score in score_counts %}
        <tr><td>{{ scoreType }}</td>
        <td>{{ count }}</td>
        <td>{{ row_score }}</td></tr>
    {% endfor %}
    <tr><td>Total</td><td></td><td>{{ game_team.score }}</td></tr>
{% else %}
    <tr><td></td><td>Wins</td></tr>
    {% for scoreType, count in score_counts %}
        <tr><td>{{ scoreType }}</td>
        <td>{{ count }}</td></tr>
    {% endfor %}
{% endif %}
</table><br/>
{% if game %}
    <div id='trades' class='accordion'>
        <div class='accordion-group'>
            <div class='accordion-heading'>
                <a class='accordion-toggle' data-toggle='collapse' data-parent='#trades' href='#offering_accordion'>Trades Offering {{ team.full_name }} ({{ offering_trades|length }})</a>
            </div>
            <div id='offering_accordion' class='accordion-body collapse'>
                <div class='accordion-inner'>
                    {% if offering_trades %}
                        {% for trade in offering_trades %}
                            {% render_offer_table trade self_entry %}
                        {% endfor %}
                    {% else %}
                        <em>None</em>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class='accordion-group'>
            <div class='accordion-heading'>
                <a class='accordion-toggle' data-toggle='collapse' data-parent='#trades' href='#asking_accordion'>Trades Asking for {{ team.full_name }} ({{ asking_trades|length }})</a>
            </div>
            <div id='asking_accordion' class='accordion-body collapse'>
                <div class='accordion-inner'>
                    {% if asking_trades %}
                        {% for trade in asking_trades %}
                            {% render_offer_table trade self_entry %}
                        {% endfor %}
                    {% else %}
                        <em>None</em>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endif %}
</div>

{% if game %}
    <div class='span5'>
        <div id='top_owners' class='well span3'>
            <strong>Top Owners</strong><br/>
            {% for owner, count in top_owners %}
                {% entry_link owner %}: {{ count }} shares<br/>
            {% endfor %}
        </div>

        <div id='offering_entries' class='well span3'>
            <strong>Entries Offering {{ team.full_name }}:</strong><br/>
            {% if offering_entries %}
                <ul>
                    {% for entry in offering_entries %}
                        <li>{% entry_link entry %}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <em>None</em>
            {% endif %}
        </div>

        <div id='asking_entries' class='well span3'>
            <strong>Entries Asking for {{ team.full_name }}:</strong><br/>
            {% if offering_entries %}
                <ul>
                    {% for entry in offering_entries %}
                        <li>{% entry_link entry %}</li>
                    {% endfor %}
                </ul>
            {% else %}
                <em>None</em>
            {% endif %}
        </div>
    </div>
{% endif %}

{% endblock game_body %}
