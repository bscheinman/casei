{% extends 'trade_tab_view.html' %}
{% load ncaa_tags %}

{% block title %}{{ team.full_name }} Profile{% endblock title %}

{% block game_scripts %}
<script type='text/javascript'>
    function OnTradeResponse(data) {
        if (data.success)
            location.reload();
        else
            alert(data.error);
    }

    $(document).ready(function() {
        var options = {
            dataType: 'json',
            success: OnTradeResponse
        };

        $('#tradeForm').ajaxForm(options);
    });
</script>
{% endblock game_scripts %}

{% block page_header %}
<h2>{{ team.full_name }} ({{ team.abbrev_name }})</h2>
{% endblock page_header %}

{% block main_tab %}
    <div id='score_counts' class='span5'>
        <table class='table table-bordered table-striped table-condensed'>
            <tr><td></td><td>Wins</td><td>Points</td></tr>
            {% for scoreType, count, row_score in score_counts %}
                <tr><td>{{ scoreType }}</td>
                <td>{{ count }}</td>
                <td>{{ row_score }}</td></tr>
            {% endfor %}
            <tr><td>Total</td><td></td><td>{{ game_team.score }}</td></tr>
        </table><br/>
    </div>
    <div id='top_owners' class='well span3'>
        <strong>Top Owners</strong><br/>
        {% for owner, count in top_owners %}
            {% entry_link owner %}: {{ count }} shares<br/>
        {% endfor %}
    </div>
{% endblock main_tab %}
{% block card_tab %}
    <div id='trades' class='accordion'>
        <div class='accordion-group'>
            <div class='accordion-heading'>
                <a class='accordion-toggle' data-toggle='collapse' data-parent='#trades' href='#offering_accordion'>
                    Trades Offering {{ team.full_name }} ({{ offering_trades|length }})</a>
            </div>
            <div id='offering_accordion' class='accordion-body collapse'>
                <div class='accordion-inner'>
                    {% if offering_trades %}
                        {% for trade in offering_trades %}
                            {% render_offer_table trade self_entry %}
                        {% endfor %}
                    {% else %}
                        <em>None</em>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class='accordion-group'>
            <div class='accordion-heading'>
                <a class='accordion-toggle' data-toggle='collapse' data-parent='#trades' href='#asking_accordion'>
                    Trades Asking for {{ team.full_name }} ({{ asking_trades|length }})</a>
            </div>
            <div id='asking_accordion' class='accordion-body collapse'>
                <div class='accordion-inner'>
                    {% if asking_trades %}
                        {% for trade in asking_trades %}
                            {% render_offer_table trade self_entry %}
                        {% endfor %}
                    {% else %}
                        <em>None</em>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block stock_tab %}
    <div class='row' style='margin-bottom:10px;'>
        <div id='market_data' class='span3 well'>
            Bid: {{ security.get_bid }}
            Ask: {{ security.get_ask }}
            Last: {{ security.get_last }}
        </div>
        <div class='span2'>
            <a data-toggle='modal' href='#order_placer' class='btn btn-primary'>Place Order</a>
        </div>
    </div>
    <div id='bbo' class='span3 well'>
        <table class='table table-striped table-condensed table-bordered'>
            <tr><td>Bids</td><td>Asks</td></tr>
                {% for bid, ask in security.get_bbo_table %}
                    <tr><td>{% if bid %}{{ bid.price }} ({{ bid.quantity_remaining }}) {% endif %}</td>
                    <td>{% if ask %}{{ ask.price }} ({{ ask.quantity_remaining }}) {% endif %}</td></tr>
                {% endfor %}
        </table>
    </div>

    <div id='order_placer' class='modal hide fade' style='width:250px;'>
        <div class='modal-header'>
            <a class='close' data-dismiss='modal'>x</a>
        </div>
        <div class='modal-body'>
            {% trade_form game team %}
        </div>
    </div>
{% endblock stock_tab %}
